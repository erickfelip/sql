Aplicac√£o 111 Backup inventario
#apex: true, auditcols: true, drop: true

TB_EQUIPAMENTOS /INSERT 3 
    ID NUMBER /pk
    ID_CATEGORIA NUMBER /fk TB_CATEGORIAS_EQUIP
    ID_SETOR NUMBER /fk TB_SETORES
    ID_RESPONSAVEL NUMBER /nn
    PATRIMONIO VC50	/UNIQUE 
    CREATED DATE
    CREATED_BY VC255 /NN
    UPDATED DATE 
    UPDATED_BY VC255 
TB_SETORES
    ID_SETOR NUMBER /pk
    NOME VC255  
    RESPONSAVEL VC255  
TB_CATEGORIAS_EQUIP
    ID_CATEGORIA /pk
    NOME VC255


-- drop objects
drop table tb_equipamentos cascade constraints;
drop table tb_setores cascade constraints;
drop table tb_categorias_equip cascade constraints;

-- create tables
create table tb_equipamentos (
    id                             number generated by default on null as identity 
                                   constraint tb_equipamentos_id_pk primary key,
    id_categoria                   number
                                   constraint tb_equipamentos_id_categori_fk
                                   references tb_categorias_equip on delete cascade,
    id_setor                       number
                                   constraint tb_equipamentos_id_setor_fk
                                   references tb_setores on delete cascade,
    id_responsavel                 number not null,
    patrimonio                     varchar2(50 char)
                                   constraint tb_equipamentos_patrimonio_unq unique,
    created                        date,
    created_by                     varchar2(255 char) not null,
    updated                        date,
    updated_by                     varchar2(255 char)
)
;

-- table index
create index tb_equipamentos_i1 on tb_equipamentos (id_categoria);
create index tb_equipamentos_i2 on tb_equipamentos (id_setor);

create table tb_setores (
    id_setor                       number generated by default on null as identity 
                                   constraint tb_setores_id_setor_pk primary key,
    nome                           varchar2(255 char),
    responsavel                    varchar2(255 char),
    created                        date not null,
    created_by                     varchar2(255 char) not null,
    updated                        date not null,
    updated_by                     varchar2(255 char) not null
)
;

create table tb_categorias_equip (
    id_categoria                   number generated by default on null as identity 
                                   constraint tb_categorias_e_id_categori_pk primary key,
    nome                           varchar2(255 char),
    created                        date not null,
    created_by                     varchar2(255 char) not null,
    updated                        date not null,
    updated_by                     varchar2(255 char) not null
)
;


-- triggers
create or replace trigger tb_categorias_equip_biu
    before insert or update 
    on tb_categorias_equip
    for each row
begin
    if inserting then
        :new.created := sysdate;
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
    end if;
    :new.updated := sysdate;
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
end tb_categorias_equip_biu;
/

create or replace trigger tb_equipamentos_biu
    before insert or update 
    on tb_equipamentos
    for each row
begin
    if inserting then
        :new.created := sysdate;
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
    end if;
    :new.updated := sysdate;
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
end tb_equipamentos_biu;
/

create or replace trigger tb_setores_biu
    before insert or update 
    on tb_setores
    for each row
begin
    if inserting then
        :new.created := sysdate;
        :new.created_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
    end if;
    :new.updated := sysdate;
    :new.updated_by := coalesce(sys_context('APEX$SESSION','APP_USER'),user);
end tb_setores_biu;
/

-- load data
 
insert into tb_equipamentos (
    id,
    id_categoria,
    id_setor,
    id_responsavel,
    patrimonio
) values (
    1,
    1,
    1,
    80,
    'Ante Ipsumprimis In Faucibus'
);

insert into tb_equipamentos (
    id,
    id_categoria,
    id_setor,
    id_responsavel,
    patrimonio
) values (
    2,
    1,
    1,
    64,
    'Ipsum Primis In Faucibus'
);

insert into tb_equipamentos (
    id,
    id_categoria,
    id_setor,
    id_responsavel,
    patrimonio
) values (
    3,
    1,
    1,
    9,
    'Sollicitudin Elementum Nulla Facilisi'
);

commit;
-- load data
 
-- Generated by Quick SQL Monday May 16, 2022  13:12:17
 
/*
#apex: true, auditcols: true, drop: true

TB_EQUIPAMENTOS /INSERT 3 
    ID NUMBER /pk
    ID_CATEGORIA NUMBER /fk TB_CATEGORIAS_EQUIP
    ID_SETOR NUMBER /fk TB_SETORES
    ID_RESPONSAVEL NUMBER /nn
    PATRIMONIO VC50	/UNIQUE 
    CREATED DATE
    CREATED_BY VC255 /NN
    UPDATED DATE 
    UPDATED_BY VC255 
TB_SETORES
    ID_SETOR NUMBER /pk
    NOME VC255  
    RESPONSAVEL VC255  
TB_CATEGORIAS_EQUIP
    ID_CATEGORIA /pk
    NOME VC255

# settings = { PK: "IDENTITY", semantics: "CHAR", auditCols: true, drop: true, language: "EN", APEX: true }
*/